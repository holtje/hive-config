---
name: versions

# https://help.github.com/en/articles/workflow-syntax-for-github-actions

on:
  push:
    paths:
      - '.github/workflows/versions.yaml'
      - 'script/update-image-from-ghcr.bash'
      - 'script/get-latest-tag.jq'
  schedule:
    - cron: "43 23 * * 0"
  workflow_dispatch: {}

jobs:
  versions:
    # Name the Job
    name: Update versions
    # Set the agent to run on
    runs-on: ubuntu-20.04

    steps:
      - name: Login to Docker Hub
        uses: docker/login-action@v1.10.0
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}

      - name: Checkout
        uses: actions/checkout@v2.4.0

      - name: Install packages
        run: "sudo apt-get install -y curl jq bash && sudo snap install yq"

      - name: Update images
        run: "bash -x ./script/update-image-from-ghcr.bash"
        env:
          GITHUB_TOKEN: ${{ secrets.GHCR_TOKEN }}

      - name: Commit
        uses: EndBug/add-and-commit@v7.5.0
        with:
          add: "docwhat-manifests/blog-staging.yaml"
          author_name: "üêù Hive Queen"
          author_email: "docwhat+hivequeen@users.noreply.github.com"
          message: "chore: ü§ñ version upgrade"
# EOF
